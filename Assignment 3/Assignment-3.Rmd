---
title: 'Assignment 3: Predators, Prey, and Foodwebs'
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Community Stability: connections count

With $S=250,\sigma=0.3$, how does stability depend on $C$?

```{r question1}
library(ggplot2)
library(psych)
S <- 250
sigma <- 0.3

MayMatrix<-function(S,C,sigma){
  ## This matrix determines the connections
  A<-matrix(runif(S*S),S,S)
  ## Contains the values for the connections
  B<-matrix(rnorm(S*S,0.0,sigma),S,S)
  A<-(A<= C)*1 # A matrix contains 1 when A[i,j] <= C
  M<-A*B
  diag(M)<- -1
  return(M)
}

PPMatrix<-function(S,C,sigma){
  ## Determine the signs for the connections
  MyS<-sign(rnorm(S*(S-1)/2))
  A<-matrix(0,S,S)
  A[upper.tri(A,diag=F)]<-MyS
  D<-matrix(runif(S*S),S,S)
  D<-(D <= C)*1
  A<-D*A
  A<- A-t(A)
  ## Contains the  values for the connections
  B<-matrix(abs(rnorm(S*S,0.0,sigma)),S,S)
  M<-A*B
  diag(M)<- -1
  return(M)
}

stableQ<- function(m){
  if(tr(m)<0 & det(m)>0){
    return(1)
  }else{
    return(0)
  }
}


C <-seq(0.01,0.5,by=0.01)

mays <- c()
for (cs in C){
  mays <- append(mays,sum(replicate(100, stableQ(MayMatrix(S,cs,sigma)), simplify = TRUE )))
}
     
pred <- c()
for (cs in C){
  pred <- append(pred,sum(replicate(100, stableQ(PPMatrix(S,cs,sigma)), simplify = TRUE )))
}

mays <- mays/100
pred <- pred/100


df=data.frame(C = C,
              values=c(mays, pred),
              matrix=c(rep("May",50),rep("Predator-Prey",50))
)


ggplot(df,aes(C,values,col=matrix))+geom_line() +
  ylab("fraction of stable communities")
```
We can see in the plot that both methods of generating matrices result in high stability for low values of C. The threshold May proves in his paper $\sqrt{SC}>\frac{1}{\sigma}$, is $C>2/45(\approx0.04444)$ when $S=250$ and $\sigma=0.3$. This is consistent with what we simulated. We can see the predator-prey matrix undergoes a similar transition at a much higher value of $C$, closer to 0.25.


## 2. Examples of particular dynamics
### 2.1 damped oscillations of a population to a stable equilibrium point

An example system that will show damped oscillations to a stable equilibrium is the predator-prey model with logistic growth described by the set of equations.
$$
\begin{cases}
\frac{dX}{dt}=(b-d)X(1-X/K)-\alpha XY\\
\frac{dY}{dt}=\alpha\epsilon XY- mY
\end{cases}
$$
![The dynamics of the predator prey model with logistic growth](/Users/katjad/Documents/UChicago/Theoretical
Ecology/TheoreticalEcologyCourseGithub/Assignment 3/2Example1)
Figure 1 shows the isoclines of this system when the birth rate of the prey $b=2$, the death rate of the prey $d=0.5$, the prey carrying capacity $K=15$, , the encounter rate $\alpha=0.5$, the conversion efficiency of the predator $\epsilon=0.9$, and the death rate for the predator $m=0.6$. We can see in this plot that whenever the system starts with $X>0$ and $Y>0$, we expect a spiral to the equilibrium. For example, let's start with $X=10$ and $Y=10$. The resulting oscillation can be seen in figure 2.

![The dynamics of the predator prey model with logistic growth](/Users/katjad/Documents/UChicago/Theoretical
Ecology/TheoreticalEcologyCourseGithub/Assignment 3/2Example1Oscillations)

### 2.2 stable cycles
The most famous example is the simple Lotka-Volterra model we started with described by the following system of equations:
$$
\begin{cases}
\frac{dN}{dt}=N(a-bP)\\
\frac{dP}{dt}=P(cN-d)
\end{cases}
$$
Here $a$ is the growth rate of the prey $N$ independent of the predator $P$ (this means exponential growth without the predator). $b$ is the predation rate of the prey by the predator, $c$ is the conversion rate of eaten prey into predator (this is $b*\epsilon=c$, where $\epsilon$ is the conversion efficiency of killed prey into predator. Lastly, $d$ is the decay rate of the predator without any prey. 

Figure 3 shows the isoclines and figure 4 the dynamics of this system when $a=2, b=1, c=0.9, d=0.5, N[0]=5, P[0]=2$

![The dynamics of the basic, Lotka-Volterra predator-prey model](/Users/katjad/Documents/UChicago/Theoretical
Ecology/TheoreticalEcologyCourseGithub/Assignment 3/2Example2)

![The dynamics of the basic, Lotka-Volterra predator-prey model](/Users/katjad/Documents/UChicago/Theoretical
Ecology/TheoreticalEcologyCourseGithub/Assignment 3/2Example2StableOscillations)

### 2.3 unstable dynamics away from a nontrivial equilibrium


### 2.4 chaotic dynamics



